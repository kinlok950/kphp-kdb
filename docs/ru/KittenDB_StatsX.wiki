== About ==
Движок используется для хранения статистики по пользователям и пользовательским группам. Поддерживает два запроса - incr и get. Жирным цветом предлагаются нововведения. Версия счётчика это unix-time момента его создания. В обычной ситуации (если не было команд disable/enable/set_time) оно является временем начала суток в соответствующей временной зоне. 

== Запрос incr ==
incr обозначает, что надо увеличить статистику по выбранному пользователю. Формат запроса: 
<br>
$MC_Stats->increment("counter$cnt_id[:$subcnt_id]#$uid[#$sex$age$status$polit$section;$city;$region;$country;$source]") 
* cnt_id - ненулевое id счетчика  (int) 
* subcnt_id - целое от 0 до 63, id подсчётчика (например, для audio или video) 
* uid - id пользователя (int) 
* sex - пол (char) от '1' до '2' 
* age - возрастная группа (сhar) от '1' до '8' 
* status -  (сhar) '1' до '8' 
* polit - политические взгляды (сhar) '1' до '8' 
* section - (char) 'A' до 'P' 
* city - (int) 
* region - регион по geoip (char[3]) 
* country - страна (char[3]) 
* source - откуда мы пришли на страницу (char) от 'A' до 'P' cnt_id и uid должны присутствовать обязательно, остальные - опционально. 
Возвращает количество уникальных пользователей, если не задан $subcnt_id и количество просмотров в противном случае. 
<br>
<b> Если указан subcnt_id все опциональные параметры игнорируются!</b>

== Запрос decr ==
Аналогичен запросу Incr. Вместо того, чтобы уменьшать значение счётчика увеличивает значение счётчика, обозначающего "вышедших" пользователей. Т.о. реальный результат - это разность. В данный момент учитывается только количество таких запросов. Никакой статистики по ним не проводится. 

== Запрос get ==
get обозначает запрос на получение статистики. 
<br>
Варианты запроса get 

=== get views ===
Возвращает в строке количество просмотров счётчика $cnt_id версии $ver. Если она не указана, то только по текущей версии. Формат запроса: 
<br>
get("views$cnt_id[@$ver]") 

=== get visitors ===
Возвращает количество уникальных просмотров счётчика $cnt_id версии $ver. Если она не указана, то только по текущей версии. Формат запроса: 
<br>
get("visitors$cnt_id[@$ver]") 

=== get enable_counter и get disable_counter ===
Включает счётчик $cnt_id и выключает счётчик $cnt_id. Возвращает 0 или 1. 
<br>
Формат get("enable_counter$cnt_id") и get("disable_counter$cnt_id"). 

=== get set_timezone ===
Изменяет временную зону для $cnt_id 
<br>
new_timezone - целое число, смещение относительно Московского времени 
<br>
Формат get("set_timezone$cnt_id#$new_timezone") 

=== get counter ===
По счётчику $cnt_id и идентификатору версии $ver возвращает ассоциативный массив статистики. 
<br>
Форматы запросов: get("[%]counter$cnt_id@$ver[?]") или get("[%]counter$cnt_id[?]"). В последнем 
случае берётся последняя (т.е. текущая) версия счётчика.
<br>
В конец этого запроса можно приписать '?', в этом случае будет возвращена версия счётчика в несериализованном виде, т.е. вызов функции unserialize будет отложен. Если в начала стоит знак %, то результат возвращается в бинарном виде. Эту фичу надо использовать только вместе с stastx-merge.
<br>
Формат возвращаемого ассоциативного массива. 
{|
|+ Формат возвращаемого счётчика
|-
! ключ
! значение 
|-
| views
| количество посетителей
|-
| visitors
| количество уникальных посетителей
|-
| deletes
| количество удалений 
|-
| created
| момент создания версии счётчика (время в Unix-time) 
|-
| expires
| момент создания новой версии счётчика 
|-
| sex
| массив из двух элементов. Первый - количество посетителей-женщин, второй-мужчин. 
|-
| age (опционально)
| массив из количеств посетителей по возрастным группам 
|-
| sex_age (опционально)
| одномерный массив, индексы от 1 до 16, индекс вычисляется по формуле: (ord($sex)-49) * 8 + ord($age) - 48 
|-
| marital_status (опционально)
| массив из количество посетителей по семейному положению 
|-
| political_views (опционально)
| массив из количество посетителей по политическим взглядам 
|-
| section (опционально)
| массив из количество посетителей 
|-
| cities (опционально)
| ассоциативный массив вида ($id_city => $visitor_number) 
|-
| geoip_countries (опционально)
| ассоциативный массив вида ($region => $visitor_number) 
|-
| countries (опционально)
| ассоциативный массив вида ($country => $visitor_number) 
|-
| sources (опционально)
| массив из количеств переходов 
|-
| extra (опционально)
| ассоциативный массив подсчетчиков вида audio 
|-
| last_month_unique_visitors (опционально)
| количество уникальных пользователей за предшествующие 40 дней
|}

=== get monthly_visitors===
get("monthly_visitors$cnt_id")
<br>
Возвращает список из 3N разделённых запятыми чисел. Первое число из каждой тройки - количество уникальных посетителей за календарный месяц, второе - номер месяца (1 -- 12), третье - номер года (1900 -- 2012).

=== get monthly_views===
get("monthly_views$cnt_id")
<br>
Аналогичен monthly_visitors, но возвращает количество просмотров за месяц, а не количество уникальных посетителей

=== get versions ===
Возвращает строку в которую через запятую выведен список всех идентификаторов версий счётчика $cnt_id. Каждый идентификатор это время создания этой версии в unix time. Формат запроса: 
<br>
get("versions$cnt_id") 

=== get counters_sum===
get("counters_sum{$cnt_id}_{$from_date}_{$end_date}
<br>
Возвращает счётчик, в котором просуммированы поля views, deletes, sex, age, marital_status, political_views, section, sex_age, sources по всем версиям с $from_date до $end_date включительно.
