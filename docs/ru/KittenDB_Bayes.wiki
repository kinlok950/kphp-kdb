KittenDB Bayes предназначен для проверки текста на наличие в нём спама либо
любой другой бинарной классификации текстов по их содержимому. Все проверяемые
тексты будем называть сообщениями. Основой движка является байесовский
анализатор, который постоянно переобучается, и если про какое-то сообщение
наверняка известно, что оно является спамом, или же наоборот, то движку можно
и нужно об этом сообщить.

Все тексты передаются в UTF-8. Табуляция является разделительным символом и не
должна встречаться внутри текстов.

== Обращение к Bayes-Engine ==
Через memcached-интерфейс на соответствующий порт.

==Операции с сообщениями==
Все операции с сообщениями происходят по следующей схеме.
Сначала нужно выполнить

<code>set("current_text{$random_tag}", "$text")</code>
<br>
для передачи текста сообщения <code>$text</code> для дальнейшей обработки
движку. При этом <code>$random_tag</code> - случайное положительное целое
число до 2000000000, служащее для идентификации запроса.
<b>Непосредственно</b> после этого выполняется команда

<code>get("<operation_name>{$random_tag}")</code>,
<br>
где <code>$random_tag</code> тоже самое случайное число, что и в предыдущем
запросе. Действие <code><operation_name></code> может быть одним из следующих:
<code>set_spam</code>, <code>set_ham</code>, <code>test</code>,
<code>test_prob</code> или одной из нескольких других команд. Подробнее о
действиях:

===Сообщить о том, что сообщение является спамом===
<code>get("set_spam{$random_tag}")</code>
<br>
Сообщение помечается как спам.

===Сообщить о том, что сообщение является не спамом===
<code>get("set_ham{$random_tag}")</code>
<br>
Сообщение помечается как не спам.

===Сообщить о том, что сообщение не является спамом, но ранее было помечено как спам===
<code>get("unset_spam{$random_tag}")</code>
<br>
Сообщение больше не считается спамом.

===Сообщить о том, что сообщение не является не спамом, но ранее было помечено как не спам===
<code>get("unset_ham{$random_tag}")</code>
<br>
Сообщение больше не считается не спамом.

===Сообщить о том, что сообщение является спамом, но ранее было помечено как не спам===
<code>get("reset_spam{$random_tag}")</code>
<br>
Сообщение помечается как спам. Равносильно последовательному применению команд
<code>unset_ham</code> и <code>set_spam</code>.

===Сообщить о том, что сообщение является не спамом, но ранее было помечено как спам===
<code>get("reset_ham{$random_tag}")</code>
<br>
Сообщение помечается как не спам. Равносильно последовательному применению
команд <code>unset_spam</code> и <code>set_ham</code>.

===Узнать, является ли сообщение спамом===
<code>get("test{$random_tag}")</code>
<br>
Возвращает "spam" или "ham", в зависимости от того, является сообщение спамом
или нет. По мнению движка, конечно. Этой стандартной функции должно хватать в
большинстве случаев. Если же хочется узнать "точную" вероятность того, что
сообщение содержит спам, можно воспользоваться следующей функцией.

===Узнать вероятность того, что сообщение является спамом===
<code>get("test_prob{$random_tag}")</code>
<br>
Возвращает вещественное число от 0.0 до 1.0 с шестью знаками после запятой.
Разделитель целой и дробной части -- точка.

== Кладжи в сообщениях==
С каждым сообщением могут быть связаны так называемые '''кладжи''' (cludges) -
дополнительные данные, передающиеся перед началом текста сообщения. Каждый
кладж имеет вид <code>\x1<название кладжа>\x20<значение кладжа>\t</code>
В кладжах движку передаётся дополнительная информация, недоступная напрямую из
текста и помогающая сделать выводы о наличии спама в сообщении.
В данный момент предопределены только два кладжа - id объекта, которому
отправляется сообщение (пользователя, группы и т.д.), для возможности
персонализации фильтрации спама, и кладж обозначающий, что сообщение является
исходящим для объекта id.

{|
|+ Предопределённые типы кладжей
|-
!Название !! Значение
|-
|uid || id объекта, которому посылается сообщение
|-
|out || 1 в случае исходящего сообщения, иначе 0 или отсутствует.
|}


== Безусловная классификация ==
Часть спама даже теоретически не может быть выявлена при помощи байесовского
анализатора. Для такого спама в движок встроена поддержка "чёрного списка"
фраз, наличие которых в сообщении означает его безусловную принадлежность к
спаму. В случае, если хотя бы одна из фраз из "чёрного списка" входит в
сообщение как '''подстрока''', то сообщение безусловно помечается как спам.
Для работы с "чёрным списком" предназначены следующие функции:

===Добавление фразы в чёрный список===
<code>set("add_black_list", "{$text}")</code>
<br>
$text - добавляемая фраза.

===Удаление фразы из чёрного списка===
<code>set("delete_black_list", "{$text}")</code>
<br>
$text - удаляемая фраза.

===Получение всех фраз из чёрного списка===
<code>get("black_list")</code>
<br>
Возвращает строку, содержащую фразы из чёрного списка, разделённые символом
табуляции '\t', в произвольном порядке.

